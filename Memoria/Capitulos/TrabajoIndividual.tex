\chapter{Trabajo individual}
\label{cap:trabajoIndiv}

En este capítulo se detalla el trabajo realizado por cada integrante del grupo de trabajo de este proyecto. En la Sección \ref{sec:trabajoBelen} se expone el trabajo realizado por Belén Serrano Antón, mientras que la Sección \ref{sec:trabajoClara} expone el de Clara de Suso Seijas.

\section{Belén}
\label{sec:trabajoBelen}

Antes de decidir el tema sobre el que iba a realizar mi Trabajo de Fin de Grado, abordé con Raquel Hervás diferentes posibilidades a finales del curso anterior. Todas ellas tenían un punto en común: la mejora del día a día del usuario final. El resultado de esas investigaciones previas acabaron derivando en el proyecto expuesto a lo largo de este documento, que tiene como finalidad la adaptación del interior de un edificio a personas con discapacidad visual. Ya en septiembre de este curso el equipo de trabajo se cerró con la llegada de Clara.

Ambas comenzamos a estudiar distintos trabajos que se habían hecho en el área de la navegación por interiores y que conforma el Capítulo \ref{cap:estadoDeLaCuestion}. Nos repartimos el trabajo entre las dos, mientras que yo me encargué de la investigación de las aplicaciones \textit{Google Maps} y \textit{BlindSquare}, Clara ultimó el resto. Además, tuvimos la oportunidad de entrevistar a usuarios reales en el Centro de Tiflotecnología e Innovación de la ONCE gracias a la profesora María Guijarro. Entre Clara y yo recogimos las notas que, posteriormente, darían lugar al Capítulo \ref{cap:once}.

Una vez se habían sentado las bases del trabajo y establecido que la tecnología utilizada iban a ser las balizas Bluetooth, me encargué de salvar la primera barrera tecnológica: poner en funcionamiento los \textit{beacons}. Para ello fue necesaria la revisión de la SDK de \textit{Kontakt}, así como la realización de diversos tutoriales a partir de los cuales ganar soltura con el nuevo entorno de desarrollo, Android Studio. El tiempo invertido en ello me permitió implementar dos aplicaciones sencillas pero funcionales, \textit{miniapp} y \textit{cuadrantes\_v1} (ver Sección \ref{sec:estudioPrecisionBeacons}). Más tarde implementaría \textit{pruebaSonido}, que recoge la lógica necesaria para detectar el \textit{beacon} más cercano. Gracias a ellas se pudo comenzar el estudio de la precisión y el comportamiento de las balizas. Las mediciones expuestas en el Capítulo \ref{cap:descripcionTrabajo} (ver Sección \ref{sub:pruebasCuadrantesv1}) y en el Anexo \ref{Appendix:ResMediciones} son el resultado de varios días de trabajo en los que se trataron distintas ubicaciones de los \textit{beacons} y se tomaron decisiones sobre la posición en la que se colocarían. Algunas de esas jornadas Clara y yo trabajamos de manera conjunta en la Facultad de Informática de la UCM y, en otras ocasiones, hice yo mediciones en solitario, cuyos resultados compartiría con Clara para su posterior discusión. Tras el estudio de los datos obtenidos se elaboraron de manera conjunta gráficas que permitieran observar el comportamiento de los \textit{beacons} de manera simplificada.

\subsection{Servidor}

Antes de comenzar con el mapeo de la Facultad ambas revisamos el trabajo de \cite{TFGguia}, con la intención de encontrar un modelo de mapeo en el que sustentar el nuestro. Además, revisamos el código del servidor de este mismo trabajo, a partir del cual me encargué de la total adaptación del mismo a nuestro proyecto\footnote{A excepción de los archivos de lectura de XML, que serían modificados por ambas a partir de la nueva información añadida.}. Para ello, en primer lugar tuve que implementar una clase Cliente en Java a través de la cual mandar mensajes al servidor para observar el funcionamiento del código. El resultado de este estudio fue la rápida sustitución del algoritmo que generaba los cuadrantes de la ruta por el algoritmo de \textit{Dijkstra}, debido a que la otra versión no generaba una lista ordenada de cuadrantes, que era lo que se buscaba. Tras ese cambio fueron diversas las pruebas que realicé utilizando los archivos XML de \cite{TFGguia}. Una vez comprobado que el código del servidor funcionaba (al menos técnicamente), Clara se encargó de realizar el mapeo de la Facultad. Mientras tanto, seguí haciendo modificaciones sobre el código del servidor, incluyendo numerosos cambios en la función \textit{generar()}. Esta función se adaptó a lo que nosotras buscábamos: instrucciones en cada cuadrante, indicación sobre la posición final del destino, adición de información adicional sobre la ruta, etc (ver Sección \ref{sub:genInstruc}). De estos cambios destaca el hecho de que el código encargado de señalizar los giros (ver Sección \ref{sub:instr_giro}) quedó simplificado en gran medida y de que de la función \textit{generar()} se eliminaron todas las dependencias del edificio\footnote{Cabe destacar que este proceso fue iterativo y fueron muchas las pruebas realizadas durante el mismo a fin de obtener un código libre de errores (o lo más libre posible).}. Esto último implicó fijar el orden en el que los archivos XML son leídos. Puesto que el código debe ser independiente del número de plantas del edificio, se presupone que el argumento de \textit{Z} (ver Sección \ref{sub:mapeo_xml}) en el XML, que corresponde con el número de planta, es la posición del array en el que se guardan los cuadrantes que pertenecen a una planta. De esta manera, los cuadrantes con $Z = 0$ se guardan en la posición $0$, los de $Z = 1$ en la posición $1$ y así sucesivamente. Esto no ocurría en la primera versión, puesto que comenzamos a mapear la Facultad por la primera planta. Tras darme cuenta de este problema, decidí renombrar todos los cuadrantes mapeados, tanto en los XML como en las referencias de la memoria, comenzando por la planta baja\footnote{Hay que tener en cuenta que el cuadrante \textit{i-ésimo} del array de cuadrantes debe corresponder con el cuadrante con identificador $i$.}, permitiendo así el mapeo de cuantas plantas se quieran. Otra consecuencia de la generalidad de la función \textit{generar()} fue la adición de información a los archivos XML. Concretamente añadí los pesos de la matriz de adyacencia, que hasta entonces se modificaban desde el código, y la posición del punto de interés de un cuadrante, que anteriormente se asumía dependiendo del número de este. 

Otro de los grandes cambios del servidor que realicé fue la sustitución de la conexión cliente-servidor, cambiando los \textit{sockets} por \textit{webSockets}. Lo que se buscaba con ello es que el código del servidor pudiera quedar en un servidor externo, de manera que se pudiera acceder desde cualquier red. Esto suponía un punto fundamental, pues sin ello no se podía probar la aplicación desde la Facultad\footnote{Hasta entonces las pruebas las había realizado sobre la red interna de mi casa.}. Gonzalo nos dio acceso a una máquina virtual. Tras la instalación de Tomcat\footnote{Los \textit{webSockets} están disponibles a partir de la versión $9$ de Tomcat.}, desplegué del código del servidor. Una vez se resolvió la parte técnica de esta conexión implementé un nuevo Main para el servidor, el cual recibía la información del cliente por medio de un \textit{webSocket}. A fin de poder realizar pruebas en el servidor sin tener que utilizar mi dispositivo móvil ni los \textit{beacons}, elaboré un archivo \textit{WebSocketClient.html} muy sencillo a través del cual poder mandar mensajes al servidor y leer su respuesta. Esto fue de gran ayuda pues me permitió probar numerosas rutas sin necesidad de simularlas mediante \textit{beacons}. De esta manera cuando realizaba pruebas desde la aplicación sabía de antemano que el código del servidor funcionaba, ayudándome a descartar posibles fallos de este. 

En cuanto al capítulo del servidor de la memoria, me encargué de la redacción de la Sección \ref{sec:servidor}.

\subsection{Cliente}

Respecto al cliente, mi trabajo comenzó con los primeros bocetos de la interfaz, que fueron discutidos y modificados entre Clara y yo, y posteriormente con los directores. Yo me encargué de la implementación de la pantalla \textit{Principal} y de una versión anterior de la pantalla \textit{Destinos}, en la cual los botones destino no eran dinámicos, incluyendo la funcionalidad de la barra de búsqueda y el micrófono. Así mismo, el código que permite la conexión con el servidor fue implementado por mí y posteriormente modificado, tras el cambio de \textit{sockets} a \textit{webSockets}. Buena parte del código de la pantalla \textit{Ruta} está reciclado del código de \textit{cuadrantes\_v1} y \textit{pruebaSonido}, pues estas ya se encargaban del escaneo de \textit{beacons} y la última tenía la lógica que permitía reconocer el \textit{beacon} más cercano. Sin embargo, sobre ella tuvo que implementarse la lógica correspondiente a la guía, que fue realizada entre Clara y yo (concretamente, realicé la funcionalidad del botón \textit{Instrucciones detalladas} y parte de la lógica correspondiente al seguimiento de la ruta). Esto constituyó la primera versión de la aplicación, sobre la cual realicé diversas pruebas, tanto del código de la propia aplicación como de la correcta conexión con el servidor. Gracias a que Raquel y Gonzalo me prestaron algunos \textit{beacons} antes del confinamiento, tuve la oportunidad de recrear algunos espacios de la facultad con ellos y así poder depurar nuestro código. Más tarde modifiqué el código del seguimiento de la ruta, haciendo que este solo llamara una vez al servidor por cada ruta solicitada\footnote{Antes se llamaba al servidor cada vez que se quería dar una nueva instrucción.}. Este cambio implicó también la manera en la que el servidor generaba el mensaje, pues, tras el cambio, debía contener toda la información relativa a la ruta en él. También añadí vibraciones distintas para el giro a la derecha y a la izquierda, haciendo que el servidor enviara información que indicara la dirección del giro y no un simple \textit{booleano} que indicaba si había que girar o no. Mi colaboración en la pantalla \textit{Ruta} finaliza con la implementación de la funcionalidad el modo silencio o \textit{mute}, correspondiente al botón del altavoz en la parte superior, que también se encuentra en la pantalla \textit{Instrucciones} (ver Figura \ref{fig:interfaz}). La última parte del código que se implementó fue la correspondiente a las pantallas \textit{Modo de uso}, para las cuales codifiqué la lógica necesaria para la pantalla \textit{Instrucciones}, que permite reutilizar la misma pantalla y navegar por la guía de uso con los botones \textit{siguiente} y \textit{anterior}. Por último, Clara implementó los botones de la pantalla \textit{Destinos} de manera dinámica, para lo cual simplemente aporté la lógica necesaria para que los botones se mostraran en el mismo orden en el que habían sido introducidos en el XML\footnote{Esto fue necesario puesto que el nombre de los destinos se almacena en una tabla hash, la cual no respeta el orden.} mediante la utilización de una lista.

Una vez se terminó con la codificación y prueba de las distintas funcionalidades de la aplicación, diseñé el logotipo de Blind Bit, cuyo color y aspecto fue modificado en colaboración con Clara. Esto me dio paso a dotar de un aspecto más corporativo a la aplicación, incluyendo los colores establecidos (morado y lila) en la interfaz. Tras algunas reuniones se decidieron los colores finales y la disposición de los mismos en los botones (de manera salteada).

En cuanto a esta parte de la memoria, me encargué de la redacción de la Sección \ref{sub:func_cliente}. La Sección \ref{sec:adaptacion} fue redactada de manera conjunta.

\subsection{Evaluación}

Debido a la situación de confinamiento que vivimos a partir del mes de marzo, nuestros planes de realizar una evaluación con usuarios y poder probar nuestra aplicación en la Facultad se vieron truncados. A pesar de ello, alumnas y directores comentamos posibles soluciones. Al final decidimos que realizar la evaluación de la aplicación era un punto importante del trabajo, para lo cual me ofrecí a desempeñarla en mi propia casa. Clara se encargó del mapeo de la vivienda, sobre los planos que proporcioné, mientras que yo me centré en el diseño y ejecución de las pruebas. Estas pruebas debían ser suficientes para demostrar tanto los puntos fuertes como las carencias de la aplicación. La ejecución de las mismas se adaptó tanto a los medios de los que disponía (solo contaba con $10$ \textit{beacons}, por lo que fue necesaria la redistribución de los mismos para diferentes pruebas) como al espacio (hubo que lidiar con la distribución de mi casa, incluyendo la parte estructural del edificio así como el mobiliario).

Durante la evaluación fueron algunos aspectos de implementación los que necesitaron algún ajuste o corrección pero todos ellos fueron solventados. Por último, redacté y detallé los resultados de la evaluación en la memoria (Capítulo \ref{cap:evaluacion}).


\section{Clara}
\label{sec:trabajoClara}

A la hora de decidir qué TFG abordar para concluir mis estudios de Ingeniería Informática buscaba uno cuya realización tuviese una repercusión positiva en la vida de las personas. De esta manera, cuando vi todos los que la universidad ofrecía en colaboración con la ONCE, me interesé por el campo de las tecnologías accesibles, indagué acerca de las diversas posibilidades existentes y finalmente me decanté por el tema de la navegación por interiores que había propuesto Belén.

A partir de ese momento, ambas comenzamos a estudiar distintos Trabajos de Fin de Grado realizados por antiguos alumnos de la UCM que, al igual que nosotras, se centraban en el área de la navegación por interiores. Al mismo tiempo, investigamos qué aplicaciones basadas en la navegación y preferiblemente adaptadas a personas con discapacidad visual había ya en el mercado para estudiar cómo funcionaban, qué tecnologías empleaban, qué funcionalidades tenían, etc. Todas estas lecturas previas están contempladas en el Capítulo \ref{cap:estadoDeLaCuestion}. Durante ese periodo tuvimos la oportunidad de ir al Centro de Tiflotecnología e Innovación de la ONCE, donde pudimos entrevistar tanto a usuarios finales como a expertos en el campo de las tecnologías accesibles. Para ello, Belén y yo preparamos un cuestionario y una vez allí recogimos las notas que, posteriormente, dieron lugar al Capítulo \ref{cap:once}. Esta visita fue posible gracias a la profesora María Guijarro y nos proporcionó información clave a la hora de decidir la dirección del TFG.

Una vez que establecimos ciertas bases del proyecto y que concluimos utilizar las balizas Bluetooth como tecnología principal, yo me encargué de estudiar los aspectos teóricos de estas (ver cómo se habían empleado en otras aplicaciones, qué posibilidades nos ofrecían en cuanto al sistema de posicionamiento, etc.) y comencé a plasmar en la memoria el trabajo de investigación realizado hasta entonces. Mientras tanto, Belén se encargó del aspecto tecnológico de los \textit{beacons}. Para ello desarrolló dos pequeñas aplicaciones en solitario \textit{miniapp} y \textit{cuadrantes\_v1} (ver Sección \ref{sec:estudioPrecisionBeacons}), que fueron imprescindibles a la hora de determinar qué posibilidades nos ofrecía la SDK de las balizas y cómo utilizarlas. Por último, un día nos reunimos en la Facultad de Informática y entre las dos desarrollamos \textit{pruebaSonido}, la cual inicialmente fue creada para pitar a mayor o menor frecuencia según la distancia a la que detectase una baliza. Sin embargo, en ese momento yo ya había investigado acerca de los posibles sistemas de posicionamiento mediante \textit{beacons}: triangulación de señales Bluetooth o posicionamiento mediante puntos de decisión basados en el \textit{beacon} más cercano. Por ello, tras una larga discusión y puesta en común de los pros y contras de cada una de ellas, Belén y yo acordamos emplear un posicionamiento basado en puntos de decisión. Entonces modificamos ligeramente la aplicación \textit{pruebaSonido} e introdujimos la lógica necesaria para detectar el \textit{beacon} más cercano y que una vez entonces pitase dependiendo de la distancia a la que se encontrase este. Todas estas aplicaciones fueron empleadas posteriormente en el estudio de la precisión y el comportamiento de las balizas, y ayudaron a medir el error y la fluctuación de la señal Bluetooth en distintos lugares de la Facultad para que posteriormente Belén y yo pudiésemos proponer la ubicación óptima de las balizas para el posicionamiento. Este estudio fue realizado en común tanto por Belén como por mí y se compone de diversas mediciones realizadas en la Facultad de Informática (ver Sección \ref{sub:pruebasCuadrantesv1} del Capítulo \ref{cap:descripcionTrabajo} y Anexo \ref{Appendix:ResMediciones}). 

\subsection{Servidor}
Antes de comenzar con el mapeo de la Facultad ambas nos informamos sobre qué modelos seguían otras aplicaciones y revisamos el trabajo de \cite{TFGguia} con la intención de encontrar un modelo de mapeo en el que sustentar nuestro proyecto. Con el mismo fin, revisamos también el código del servidor de este mismo trabajo para ver qué partes podían ser reutilizadas. Una vez que realizamos esto en común, dividimos tareas y Belén se encargó de la adaptación del servidor a nuestro proyecto, mientras que yo me encargué de todo lo relativo al mapeo. Para ello, comencé siguiendo la idea propuesta en el trabajo de \cite{TFGguia} que no había sido implementada por completo. Entonces la desarrollé y la adapté a nuestro proyecto, es decir, eliminé la información relativa a las coordenadas de los cuadrantes y añadí el identificador del \textit{beacon} asociado a él. En un primer momento decidí que los cuadrantes tendrían una baliza asociada como mucho pero que también podrían existir cuadrantes sin \textit{beacon}. A la vez se me ocurrió incluir un campo \textit{metros} que indicase la longitud del cuadrante y pudiese ser utilizado para aportar más precisión a las instrucciones y otro de \textit{info} que sirviese para una futura funcionalidad que describiese el entorno del usuario (idea que nació a raíz de la visita a la ONCE). Mientras que yo realizaba esta primera versión del mapeo de la primera planta, Belén continuaba adaptando el servidor, especialmente la función encargada de generar la ruta y las instrucciones (ver Sección \ref{sub:genInstruc}). Este proceso fue muy sincronizado ya que el servidor y los archivos XML tenían que acoplarse perfectamente. Para ello, concretábamos muchas reuniones online en las que Belén y yo nos poníamos de acuerdo con los detalles de implementación y las decisiones que tomábamos (de esta manera las dos estábamos al tanto de todo el proyecto). Cuando yo terminé la primera versión del mapeo, Belén realizó numerosas pruebas y continuamos con el proceso de mejora. Una de las cosas que determinamos respecto al mapeo es que los cuadrantes sin baliza carecían de sentido por lo que en la segunda versión redefiní todos los cuadrantes de la planta 1, dibujando unos totalmente nuevos. Por último, desarrollé una propuesta de mapeo de la planta baja (planta que hasta entonces nunca se había abarcado) que, tras comentar con Belén, implementé. De esta manera, Belén desarrolló la lógica necesaria en la función \textit{generar()} e incluimos rutas que iban de una planta a otra. Cabe destacar que este proceso fue iterativo y fueron muchas las pruebas realizadas y los cambios en consecuencia hasta dar con la versión final.

Otro de los grandes cambios del servidor fue la sustitución de la conexión cliente-servidor, cambiando los \textit{sockets} por \textit{webSockets}. Lo que se buscaba con ello es que el código del servidor pudiera quedar en un servidor externo, de manera que se pudiera acceder desde cualquier red. Esto suponía un punto fundamental, pues sin ello no se podía probar la aplicación desde la Facultad. Para ello, Belén y yo nos reunimos en numerosas ocasiones en la Facultad pero cuando comenzó el confinamiento a causa de la COVID-19 fue Belén quien continuó en solitario con la tarea. Una vez implantados los \textit{webSockets}, Belén implementó un nuevo Main para el servidor y yo para el Cliente, que utilizaban este mecanismo para el traspaso de información.

\subsection{Cliente}

Respecto al cliente, Belén elaboró unos bocetos sobre la interfaz que discutimos entre las dos y modificamos. Una vez que decidimos sobre el papel el funcionamiento del Cliente, yo me encargué de la implementación del layout y la lógica que hay detrás de la pantalla \textit{Modo de uso}. También elaboré el layout de la pantalla \textit{Instrucciones} y posteriormente entre Belén y yo implementamos la lógica de dicha pantalla. Con respeto a la pantalla de destinos hicimos dos versiones, una estática y otra dinámica. La estática consistía en dos pantallas (\textit{Lista de destinos} y \textit{Lista de aulas}) en las que los botones estaban ``cableados'', y por tanto sujetos a que el edificio fuese exclusivamente la Facultad de Informática (de esta primera versión Belén hizo la pantalla \textit{Lista de destinos} y yo \textit{Lista de aulas}). Por ello, cuando buscamos generalizar la aplicación, decidimos elaborar esta pantalla de manera dinámica para que así el Cliente leyese la lista de destinos de un archivo XML y pudiese generar la tabla de botones acorde al número de destinos existentes, añadir los nombres correspondientes al edificio en cuestión y añadir los niveles de esta pantalla que hiciesen falta (por ejemplo, en nuestro caso el botón Aulas te lleva a un segundo nivel donde se genera otra cuadrícula dinámica con el conjunto de posibles aulas que hay en la Facultad de Informática). De la implementación de la pantalla dinámica me encargué yo. Por otro lado, Belén se encargó de la lógica relativa a la barra de búsqueda y al micrófono. 

Con respecto a la lógica de la pantalla \textit{Ruta}, buena parte del código está reciclado del código de \textit{cuadrantes\_v1} y \textit{pruebaSonido}, pues estas ya se encargaban del escaneo de \textit{beacons} y la última tenía la lógica que permitía reconocer el \textit{beacon} más cercano. Sin embargo, sobre ella tuvo que implementarse la lógica correspondiente a la guía, que fue realizado entre Belén y yo. Concretamente, yo realicé la funcionalidad del botón \textit{Finalizar ruta} que conecta con la funcionalidad del botón \textit{Atrás} (siempre que haya una ruta en curso) y la funcionalidad de reproducir las instrucciones en voz alta (para lo cual añadí la clase TTSManager) que se emplea en el seguimiento de la ruta y en la funcionalidad del botón \textit{Repetir instrucción}. Más tarde, para complementar esta pantalla propuse a Belén utilizar vibraciones y sonidos que de manera intuitiva ayudasen al usuario a saber si iba en la dirección adecuada, si había una intersección, si había llegado a su destino, etc. Tras comentarlo, entre las dos implementamos esta funcionalidad.

\subsection{Evaluación}

Debido a la situación de confinamiento que vivimos a partir del mes de marzo, nuestros planes de realizar una evaluación con usuarios finales y poder probar nuestra aplicación en la Facultad se vieron truncados. Por este motivo, tuvimos varias reuniones y finalmente decidimos reutilizar la aplicación para realizar una guía por la casa de Belén (ya que por cuestiones de dimensiones era la más apropiada de las dos), de manera que pudiésemos poner a prueba el carácter genérico de nuestra aplicación y pudiésemos llevar a cabo una evaluación sobre esta. Por motivos plenamente logísticos yo me encargué del mapeo de la vivienda, gracias a los planos que Belén me proporcionó, y ella se centró en el diseño y ejecución de las pruebas. 
